# 心印助记字密钥保护方案

- [『心印助记字』演示](https://www.wangxiang.work/xinyin/demo/)

## 1. 概述

本方案旨在为 Solana 钱包密钥（Raw Key）提供一种安全、易抄录、便于恢复的保护与编码机制。用户只需牢记“心印”（Heartprint）以及32个汉字“心印助记字”，即可还原原始密钥，无需依赖传统助记词或明文存储。

## 2. 术语表

- **心印（Heartprint）**  
  只有用户自己知道的一句话，是整个方案的安全根基，用于密钥派生和字表生成。

- **基础字集（Primary Charset）**  
  从《通用规范汉字表》中选取的一段连续汉字，作为编码候选池。

- **心印字表（Mnemonic Charset）**  
  由心印和基础字集通过确定性算法（如 ChaCha20Rng）随机排序、抽取256个汉字后得到的有序汉字集合，用于字节到汉字的映射。

- **心印助记字**  
  用于表示加密密钥的32个汉字，每个汉字唯一对应加密密钥中的一个字节。

- **原始密钥（Raw Key）**  
  Solana 钱包生成的32字节原始密钥，是最终需要保护与还原的敏感数据。

- **加密密钥（Encrypted Key）**  
  采用心印派生的AES密钥和IV对原始密钥加密所得的32字节密文。

## 3. 工作流程

### 3.1 密钥生成与编码

1. **生成原始密钥**  
   使用操作系统级随机源（OsRng）生成32字节的原始密钥（Raw Key）。

2. **派生加密参数**  
   - 用户自定义“心印”（Heartprint）。
   - 以心印为输入，利用 Argon2 算法派生32字节 AES 密钥。
   - 用心印经 SHA256 后生成 AES-CBC 模式所需的IV（取其前16字节）。

3. **加密原始密钥**  
   用所得 AES 密钥和IV对 Raw Key 进行 CBC 模式加密，得到32字节的加密密钥（Encrypted Key）。

4. **生成心印字表**  
   - 根据指定的基础字集（Primary Charset）范围，从《8105个通用规范汉字》里截取一段备选汉字集合。
   - 用心印经 SHA256 作为 ChaCha20Rng 的种子，在基础字集中随机、无重复、顺序选出256个汉字，形成心印字表（Mnemonic Charset）。

5. **编码为心印助记字**  
   - 将 Encrypted Key 每个字节（0-255）作为心印字表的索引，取出对应汉字，得到32个“心印助记字”。
   - 用户可手写、抄录或记忆该32个汉字。

### 3.2 密钥还原

要还原钱包密钥，用户需准备：

- 心印（Heartprint）
- 基础字集的起始位置和长度
- 32个心印助记字

还原步骤如下：

1. **重建心印字表**  
   - 用心印和基础字集参数，按固定算法重建256字的心印字表。

2. **助记字解码**  
   - 将32个心印助记字依次映射回其在心印字表中的索引，拼成32字节的加密密钥（Encrypted Key）。

3. **解密还原原始密钥**  
   - 用心印派生出相同的AES密钥和IV，解密 Encrypted Key，得到原始密钥（Raw Key）。

## 4. 安全性分析

- **安全根基**  
  该方案的安全性完全依赖于心印（Heartprint）的复杂度和不可预测性。心印应足够长且难以被暴力破解。
- **编码安全**  
  只有同时拥有心印、基础字集参数和32个心印助记字，才能还原原始密钥。即使心印助记字泄露，无法逆推出心印和原始密钥。
- **算法确定性**  
  字表生成和加密解密过程均为确定性算法，保证同样输入必然还原同样密钥。

## 5. 使用建议

- 心印建议为20字符以上，包含多种字符类型，避免使用常见语句或个人信息。
- 基础字集参数与助记字建议妥善保存，可纸质抄录。
- 本方案适合对安全性有高要求且有抄录需求的钱包私钥保护场景。

## 6. 示例

假设：

- 心印：“星辰大海，心自无疆。”
- 基础字集起始索引：1000，长度：512
- 32个心印助记字：“潮、映、澄、……（共32字）”

用户只需妥善保存上述三项，即可随时还原钱包密钥。
